# 安装和基本配置



**Nginx** 是一个高性能的 HTTP 和反向代理服务器



## 安装

### Ubuntu安装

```js
apt-get install nginx -y
```

### centos8安装nginx

##### 首先看看服务器内yum内的Nginx源的版本

```
yum list | grep nginx
```

> centos8 yum仓库中内置的nginx版本是 1.14，版本太低了

##### 添加nginx源。创建文件/etc/yum.repos.d/nginx.repo

```bash
vim /etc/yum.repos.d/nginx.repo
```

```bash
[nginx-stable]
name=nginx stable repo
baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
gpgcheck=1
enabled=1
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true

[nginx-mainline]
name=nginx mainline repo
baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/
gpgcheck=1
enabled=0
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true
```

##### 查看 nginx 源

```bash
yum info nginx
```

##### 安装 nginx 并查看版本

```bash
yum install nginx -y
nginx -v
# 1.18
```



## 初始化

##### 设置 Nginx 的开机启动

```
systemctl enable nginx
```

##### 启动 Nginx 

```bash
systemctl start nginx
# 或 nginx
```

> 访问你的 IP，这时候就可以看到 Nginx 的欢迎页面了～ `Welcome to nginx！`

```bash
systemctl start nginx    # 启动 Nginx
systemctl stop nginx     # 停止 Nginx
systemctl restart nginx  # 重启 Nginx
systemctl reload nginx   # 重新加载 Nginx，用于修改配置后
systemctl enable nginx   # 设置开机启动 Nginx
systemctl disable nginx  # 关闭开机启动 Nginx
systemctl status nginx   # 查看 Nginx 运行状态
```







### nginx配置

进入 `/etc/nginx` 文件夹，主文件是`/etc/nginx/nginx.conf`，会导入`conf.d`文件夹的所有子配置项

##### /etc/nginx/nginx.conf

```bash
user  nginx;                        # 运行用户，默认即是nginx，可以不进行设置
worker_processes  1;                # Nginx 进程数，一般设置为和 CPU 核数一样
error_log  /var/log/nginx/error.log warn;   # Nginx 的错误日志存放目录
pid        /var/run/nginx.pid;      # Nginx 服务启动时的 pid 存放位置

events {
    worker_connections 1024;   # 每个进程允许最大并发数
}

http {   # 配置使用最频繁的部分，代理、缓存、日志定义等绝大多数功能和第三方模块的配置都在这里设置

		include             /etc/nginx/mime.types;      # 文件扩展名与类型映射表
    default_type        application/octet-stream;   # 默认文件类型
    
    # 设置日志模式
    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;   # Nginx访问日志存放位置

    sendfile            on;   # 开启高效传输模式
    tcp_nopush          on;   # 减少网络报文段的数量
    keepalive_timeout   65;   # 保持连接的时间，也叫超时时间，单位秒
    gzip                on;   # 开启gzip压缩

    include /etc/nginx/conf.d/*.conf;   # 加载子配置项
    
    }
}
```



`/etc/nginx/conf.d/default.conf`

```bash
server {
    listen       80;		# 配置监听的端口
    server_name  zwhid.online;		# 配置的域名

    #charset koi8-r;		# 字符集配置
    #access_log  /var/log/nginx/host.access.log  main;  # Nginx访问日志存放位置，可自定义子项日志

    location / {
        root   /usr/share/nginx/html;		# 网站根目录
        index  index.html index.htm;		# 默认首页文件
        deny 172.168.22.11;   # 禁止访问的ip地址，可以为all
    		allow 172.168.33.44； # 允许访问的ip地址，可以为all
    }

    #error_page  404              /404.html;  # 默认404对应的访问页面

    # redirect server error pages to the static page /50x.html
    error_page   500 502 503 504  /50x.html; # 默认50x对应的访问页面
    location = /50x.html {
        root   /usr/share/nginx/html;
    }
}
```



1. `=` 精确匹配路径，用于不含正则表达式的 uri 前，如果匹配成功，不再进行后续的查找；
2. `^~` 用于不含正则表达式的 uri； 前，表示如果该符号后面的字符是最佳匹配，采用该规则，不再进行后续的查找；
3. `~` 表示用该符号后面的正则去匹配路径，区分大小写；
4. `~*` 表示用该符号后面的正则去匹配路径，不区分大小写。跟 `~` 优先级都比较低，如有多个location的正则能匹配的话，则使用正则表达式最长的那个；

如果 uri 包含正则表达式，则必须要有 `~` 或 `~*` 标志。



```bash
server {
  listen 80;
	server_name zwhid.online;

	location ~ /note/ {
		root  /usr/share/nginx/html/note;
		index index.html;
	}
}
```





```bash
# 进入配置目录
cd /etc/nginx/sites-enabled

# 新增配置文件
vi crawl.conf
```

```basic
upstream crawl{
    server localhost:3000;
}
server {
    listen 80;
    server_name 42.192.228.164;
    location / {
        proxy_pass http://crawl;
    }
}
```

`http//42.192.228.164` =>`http//42.192.228.164:3000`

### 重启nginx

```js
nginx -s reload
```



